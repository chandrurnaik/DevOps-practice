pipeline {
    agent none
    environment {
        BUILD_NAME = "test"
    }
    stages {
        stage ('BUILD') {
            agent {
                label 'master'
            }
            steps {
                script {
                    echo "${env.BUILD_NAME} environment"
                    sh 'sleep 1'
                }
            }
        }
        stage ('TEST') {
            agent {
                label 'slave1'
            }
            steps {
                script {
                    env.BUILD_NAME = "deploy"
                    sh 'sleep 1'
                }
            }
        }
        stage ('DEPLOY') {
            agent {
                label 'slave2'
            }
            steps {
                script {
                    echo "${env.BUILD_NAME}" 
                    sh 'sleep 1'
                }
            }
        }
    }
}